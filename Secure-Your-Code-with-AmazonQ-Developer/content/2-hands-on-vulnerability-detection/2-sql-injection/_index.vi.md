---
title: "SQL Injection"
date: "`r Sys.Date()`"
weight: 2
chapter: false
pre: " <b> 2.2 </b> "
---

Lỗ hổng SQL injection xuất hiện trong mã khi các đầu vào do người dùng cung cấp không được làm sạch trước khi được sử dụng để tạo truy vấn cơ sở dữ liệu SQL. Kẻ tấn công có thể lạm dụng đầu vào không đáng tin cậy để chạy các câu lệnh truy vấn đọc, sửa đổi hoặc xóa nội dung cơ sở dữ liệu.

1. Sao chép đoạn mã sau vào IDE của bạn. Đoạn mã này dễ bị tấn công SQL injection vì nó xây dựng truy vấn SQL bằng cách nối trực tiếp đầu vào của người dùng (name) vào chuỗi truy vấn. Kẻ tấn công có thể thao túng tham số name để thay đổi lệnh SQL, có khả năng giành quyền truy cập trái phép vào dữ liệu khác trong cơ sở dữ liệu, làm hỏng dữ liệu hoặc thậm chí xóa các bảng.

   ```
   def execute_query_noncompliant(request):

       import sqlite3

       name = request.GET.get("name")

       query = "SELECT * FROM Users WHERE name = " + name + ";"

       with sqlite3.connect("example.db") as connection:

           cursor = connection.cursor()

           # Noncompliant: user input is used without sanitization.

           cursor.execute(query)

           connection.commit()

           connection.close()
   ```

2. Nhấp vào **Amazon Q** trên thanh trạng thái và chạy **Project Scan** để xem cách phát hiện Lỗ hổng SQL Injection.
   ![autoscans](/images/1/autoscans.png?width=90pc)

3. Chọn **Review workspace** or **Review active file**
   ![SQL-Injection](/images/2/sql-injection-1.png?width=90pc)

4. Phát hiện sau sẽ hiển thị trên thanh trạng thái
   ![SQL-Injection-2](/images/2/sql-injection-2.png?width=90pc)

5. Để xem chi tiết các phát hiện, giữ con trỏ chuột trên đoạn mã không an toàn và nhấp vào “View Details” để tìm hiểu thêm:
   ![SQL-Injection-3](/images/2/sql-injection-3.png?width=90pc)
   ![SQL-Injection-3](/images/2/sql-injection-4.png?width=90pc)

6. Để khắc phục lỗ hổng SQL Injection trong đoạn mã được cung cấp, bạn nên sử dụng các truy vấn tham số hóa, còn được gọi là prepared statements. Phương pháp này đảm bảo rằng các đầu vào của người dùng được xử lý an toàn, ngăn chặn kẻ tấn công chèn mã SQL độc hại.

   Dưới đây là một ví dụ về cách khắc phục đoạn mã này. Đảm bảo lưu tệp trước khi chạy lại quá trình quét.

   ```
   def execute_query_compliant(request):
   import sqlite3

   name = request.GET.get("name")

   query = "SELECT * FROM Users WHERE name = ?"

   with sqlite3.connect("example.db") as connection:
       cursor = connection.cursor()
       cursor.execute(query, (name,))  # Use a parameterized query
       connection.commit()
       connection.close()
   ```

7. Thử khắc phục vấn đề và chạy lại quá trình quét.
