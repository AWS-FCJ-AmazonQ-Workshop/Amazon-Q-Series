+++
title = "Lỗ hổng Open Redirect"
date = 2020-05-14T00:38:32+07:00
weight = 1
chapter = false
pre = "<b>1. </b>"
+++

Lỗ hổng Open Redirect (Chuyển hướng Mở) là một điểm yếu bảo mật, trong đó kẻ tấn công có thể cung cấp một URL độc hại làm đầu vào, có khả năng dẫn người dùng đến các trang web lừa đảo hoặc chứa phần mềm độc hại. Đây là một lỗi bảo mật phổ biến trong các ứng dụng web có thể bị khai thác để thực hiện các cuộc tấn công lừa đảo hoặc phát tán phần mềm độc hại.

1. Đầu tiên, tạo một thư mục. Sau đó, tạo một tệp .py bên trong và dán đoạn mã sau vào tệp.

   ```
   from flask import app

   @app.route('/redirect')

   def redirect_url_noncompliant():

       from flask import request, redirect
       endpoint = request.args['url']
       # Noncompliant: redirect to a user-supplied URL without sanitization.

       return redirect(endpoint)
   ```

2. Nhấp vào **Amazon Q** trên thanh trạng thái và chạy **Project Scan** để xem cách phát hiện Lỗ hổng Open Redirect.
   ![autoscans](/images/1/autoscans.png?width=90pc)

3. Chọn **Review workspace** or **Review active file**
   ![Open-redirect-1](/images/1/open-redirect-1.png?width=90pc)

4. Phát hiện sau sẽ hiển thị trên thanh trạng thái
   ![Open-redirect-2](/images/1/open-redirect-2.png?width=90pc)

5. Để xem chi tiết các phát hiện, giữ con trỏ chuột trên đoạn mã không an toàn và nhấp vào "View Details" để tìm hiểu thêm:
   ![Open-redirect-3](/images/1/open-redirect-3.png?width=90pc)
   ![Open-redirect-4](/images/1/open-redirect-4.png?width=90pc)

6. Để khắc phục vấn đề chuyển hướng mở trong đoạn mã được cung cấp, bạn nên xác thực và/hoặc làm sạch URL trước khi thực hiện chuyển hướng. Ví dụ: chỉ cho phép chuyển hướng đến các miền đã biết, an toàn bằng cách kiểm tra URL do người dùng cung cấp với danh sách trắng.

   Dưới đây là một ví dụ về cách khắc phục đoạn mã này. Đảm bảo lưu tệp trước khi chạy lại quá trình quét.

   ```
   from flask import Flask, request, redirect, url_for

   app = Flask(__name__)

   ALLOWED_HOSTS = ['www.example.com', 'example.org']

   @app.route('/redirect')
   def redirect_url():
      from urllib.parse import urlparse

      # Retrieve the URL from request arguments and parse it
      user_url = request.args.get('url', '')
      parsed_url = urlparse(user_url)

      # Check if the URL's host is in the list of allowed hosts
      if parsed_url.netloc in ALLOWED_HOSTS:
         return redirect(user_url)
      else:
         # Redirect to a default page or show an error
         return redirect(url_for('index'))  # Assume 'index' is a valid endpoint
   ```

7. Thử khắc phục vấn đề và chạy lại quá trình quét.
